<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>CardioResp Escape - Image Edition</title>

  <!-- (Opcional) S√≥ funciona se existir no seu ambiente -->
  <script src="./_sdk/element_sdk.js"></script>
  <script src="./_sdk/data_sdk.js"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323&display=swap" rel="stylesheet" />

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; font-family: 'Orbitron', sans-serif; overflow: hidden; }
    body { background: linear-gradient(135deg, #0a0e27 0%, #1a1a3e 50%, #0f2a4a 100%); color: #fff; }

    .app-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }

    .hud-bar{
      background: linear-gradient(90deg, #e91e63 0%, #ff1744 50%, #d32f2f 100%);
      padding: 12px 20px;
      display:flex; justify-content:space-between; align-items:center;
      box-shadow: 0 4px 20px rgba(233,30,99,.5);
      flex-shrink: 0; gap: 20px;
    }
    .hud-title{ font-size:16px; font-weight:900; text-shadow:2px 2px 0 #000; letter-spacing:2px; }
    .hud-stats{ display:flex; gap:20px; font-size:12px; font-weight:bold; }
    .stat-item{ background: rgba(0,0,0,.3); padding:6px 14px; border-radius:6px; display:flex; align-items:center; gap:6px; }

    .game-container{ flex:1; display:flex; flex-direction:column; position:relative; overflow:hidden; }

    .game-viewport{
      flex:1; position:relative;
      background: linear-gradient(180deg,#1a2a4a 0%,#0d1b3a 50%,#0a0f25 100%);
      overflow:hidden;
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap:20px;
      padding:30px;
      align-content:center;
      justify-content:center;
    }

    .question-card{
      background: linear-gradient(135deg,#1a3a5a,#0d2a4a);
      border:3px solid #00bcd4;
      border-radius:16px;
      cursor:pointer;
      transition: all .25s ease;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:12px; padding:16px; text-align:center;
      box-shadow: 0 8px 24px rgba(0,0,0,.5);
      position:relative; overflow:hidden;
      min-height:180px;
      user-select:none;
    }
    .question-card::before{
      content:'';
      position:absolute; inset:0;
      background: linear-gradient(135deg, rgba(77,208,225,.2) 0%, transparent 100%);
      opacity:0; transition: opacity .25s ease;
    }
    .question-card:hover{
      transform: translateY(-8px) scale(1.05);
      border-color:#4dd0e1;
      box-shadow:0 12px 32px rgba(0,188,212,.5);
    }
    .question-card:hover::before{ opacity:1; }

    .question-card.completed{
      border-color:#4caf50;
      background: linear-gradient(135deg, rgba(76,175,80,.2), rgba(76,175,80,.1));
      pointer-events:none;
      cursor: default;
    }
    .question-card.bonus{
      border-color:#ff9800;
      background: linear-gradient(135deg, rgba(255,152,0,.12), rgba(255,152,0,.06));
    }

    .card-image{
      width:100%;
      height:100px;
      object-fit:cover;
      border-radius:12px;
      background: rgba(0,0,0,.3);
      margin-bottom: 8px;
    }
    .card-title{
      font-size:13px;
      color:#4dd0e1;
      font-weight:bold;
      z-index:2;
      line-height:1.2;
    }
    .card-status{ font-size:11px; color:#aaa; z-index:2; }

    .controls-bar{
      display:flex; justify-content:center; align-items:center;
      padding: 14px 20px;
      background: rgba(0,0,0,.6);
      gap: 20px;
      flex-shrink: 0;
    }
    .btn{
      padding: 12px 24px;
      background: linear-gradient(145deg,#e91e63,#ff1744);
      border: 2px solid #ff5252;
      border-radius: 8px;
      color:#fff;
      font-weight:bold;
      cursor:pointer;
      font-family:'Orbitron',sans-serif;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .btn:hover{ transform: scale(1.03); box-shadow: 0 0 18px rgba(233,30,99,.45); }
    .btn:active{ transform: scale(0.99); }

    .modal{
      position:fixed; inset:0;
      background: rgba(0,0,0,.88);
      display:flex; align-items:center; justify-content:center;
      z-index:200;
      opacity:0; visibility:hidden;
      transition: all .25s ease;
      backdrop-filter: blur(0px);
      padding:20px;
    }
    .modal.open{ opacity:1; visibility:visible; backdrop-filter: blur(3px); }

    .modal-content{
      background: linear-gradient(145deg,#1a2a4a,#0d1b3a);
      border:2px solid #00bcd4;
      border-radius:16px;
      width:100%;
      max-width:650px;
      max-height:85vh;
      overflow:hidden;
      box-shadow: 0 25px 70px rgba(0,0,0,.7), 0 0 40px rgba(0,188,212,.25);
      animation: modalIn .35s cubic-bezier(.34,1.56,.64,1);
      display:flex;
      flex-direction:column;
    }
    @keyframes modalIn{
      from{ transform: translateY(-50px) scale(.92); opacity:0; }
      to{ transform: translateY(0) scale(1); opacity:1; }
    }

    .modal-header{
      display:flex; justify-content:space-between; align-items:center;
      padding:16px 20px;
      border-bottom:2px solid #00bcd4;
      flex-shrink:0;
    }
    .modal-title{
      background: linear-gradient(90deg,#e91e63,#ff1744);
      color:#fff;
      padding:6px 14px;
      border-radius:20px;
      font-size:10px;
      font-weight:bold;
      text-transform:uppercase;
      letter-spacing:1px;
    }
    .modal-close{
      width:36px; height:36px;
      background: rgba(255,255,255,.1);
      border:none; border-radius:50%;
      color:#fff; font-size:24px;
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition: background .2s ease;
    }
    .modal-close:hover{ background:#e91e63; }

    .modal-body{
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:16px;
      overflow:auto;
    }

    .question-image-container{
      width:100%; height:250px;
      background: rgba(0,0,0,.3);
      border:2px solid #00bcd4;
      border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .question-image{ width:100%; height:100%; object-fit:contain; }

    .question-title{ color:#4dd0e1; font-size:16px; font-weight:bold; }
    .question-text{ color:#ccc; font-size:13px; line-height:1.6; }

    .options-list{ display:flex; flex-direction:column; gap:10px; }
    .option-btn{
      padding:12px 16px;
      background: rgba(45,74,111,.5);
      border:2px solid #0d4a6a;
      border-radius:10px;
      color:#fff;
      text-align:left;
      font-size:12px;
      cursor:pointer;
      transition: all .2s ease;
      font-family:'Orbitron',sans-serif;
      word-break: break-word;
    }
    .option-btn:hover{
      background: rgba(77,208,225,.2);
      border-color:#00bcd4;
      transform: translateX(4px);
    }
    .option-btn.correct{ background: rgba(76,175,80,.3); border-color:#4caf50; }
    .option-btn.wrong{ background: rgba(233,30,99,.3); border-color:#e91e63; }
    .option-btn:disabled{ opacity:.65; cursor:not-allowed; transform:none; }

    .feedback{
      margin-top:12px;
      padding:12px;
      border-radius:10px;
      font-size:12px;
      line-height:1.5;
      display:none;
    }
    .feedback.show{ display:block; }
    .feedback.correct{ background: rgba(76,175,80,.2); border:1px solid #4caf50; color:#81c784; }
    .feedback.wrong{ background: rgba(233,30,99,.2); border:1px solid #e91e63; color:#ec407a; }

    .robot-collection{
      position:fixed;
      bottom:20px; left:50%;
      transform: translateX(-50%);
      display:flex;
      gap:15px;
      z-index:180;
      flex-wrap: wrap;
      justify-content:center;
      max-width: 92vw;
    }
    .robot-collector{
      width:60px; height:60px;
      border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      font-size:30px;
      box-shadow:0 8px 24px rgba(102,126,234,.4);
      animation: robot-bounce .6s ease-in-out forwards;
      border:2px solid #4dd0e1;
    }
    @keyframes robot-bounce{
      0%{ transform: scale(0) translateY(100px); opacity:0; }
      50%{ transform: scale(1.1); }
      100%{ transform: scale(1) translateY(0); opacity:1; }
    }

    .robot-tip{
      position:fixed;
      bottom:100px; right:20px;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color:#fff;
      padding:16px 20px;
      border-radius:16px;
      max-width:280px;
      font-size:12px;
      z-index:180;
      box-shadow:0 8px 32px rgba(102,126,234,.4);
      animation: tip-slide-in .35s ease-out;
      border-left:4px solid #4dd0e1;
    }
    @keyframes tip-slide-in{
      from{ transform: translateX(400px) translateY(20px); opacity:0; }
      to{ transform: translateX(0) translateY(0); opacity:1; }
    }
    .robot-tip strong{ display:block; margin-bottom:8px; color:#4dd0e1; }

    .video-player{ width:100%; max-width:600px; border-radius:12px; background:#000; }

    .victory-content{ text-align:center; padding:30px 20px; }
    .victory-emoji{ font-size:80px; margin-bottom:16px; animation: bounce-victory 1s ease-in-out infinite; }
    @keyframes bounce-victory{ 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-15px); } }
    .victory-title{
      font-family:'VT323', monospace;
      font-size:24px;
      color:#4dd0e1;
      margin-bottom:12px;
      text-shadow:2px 2px 0 #000;
      letter-spacing:2px;
    }
    .victory-stats{ display:flex; justify-content:center; gap:40px; margin:20px 0; flex-wrap:wrap; }
    .victory-stat{ text-align:center; }
    .victory-value{ font-size:32px; font-weight:900; color:#ff1744; }
    .victory-label{ font-size:10px; color:#888; margin-top:6px; text-transform:uppercase; }

    .restart-btn{
      padding:14px 32px;
      background: linear-gradient(145deg,#e91e63,#ff1744);
      border:2px solid #ff5252;
      border-radius:30px;
      color:#fff;
      font-size:14px;
      font-weight:bold;
      cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease;
      margin-top:20px;
      font-family:'Orbitron',sans-serif;
    }
    .restart-btn:hover{ transform: scale(1.05); box-shadow:0 0 25px rgba(233,30,99,.6); }

    .coin-float{
      position:fixed;
      pointer-events:none;
      z-index:300;
      font-size:40px;
      animation: coin-rise .8s cubic-bezier(.34,1.56,.64,1) forwards;
      text-shadow:0 0 20px rgba(255,215,0,.9);
      filter: drop-shadow(0 0 8px #ffd700);
    }
    @keyframes coin-rise{
      0%{ opacity:1; transform: translateY(0) scale(.5) rotateZ(0deg); }
      100%{ opacity:0; transform: translateY(-100px) scale(1) rotateZ(360deg); }
    }

    @media (max-width: 768px){
      .game-viewport{
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(4, 1fr);
        padding:18px;
        gap:14px;
      }
      .question-card{ min-height:150px; }
    }
  </style>
</head>

<body>
  <div class="app-wrapper">
    <header class="hud-bar">
      <div class="hud-title" id="gameTitle">ü´Ä CardioResp Escape</div>
      <div class="hud-stats">
        <div class="stat-item"><span>ü™ô</span> <span id="coinCount">0</span></div>
        <div class="stat-item"><span>ü§ñ</span> <span id="robotCount">0</span>/8</div>
      </div>
    </header>

    <div class="game-container">
      <div class="game-viewport" id="gameViewport"></div>
      <div class="controls-bar">
        <button class="btn" id="resetBtn" type="button">üîÑ Reiniciar</button>
      </div>
    </div>

    <div class="robot-collection" id="robotCollection"></div>
  </div>

  <!-- Question Modal -->
  <div class="modal" id="questionModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="Quest√£o">
      <div class="modal-header">
        <span class="modal-title" id="questionBadge">QUEST√ÉO</span>
        <button class="modal-close" id="closeQuestion" type="button" aria-label="Fechar">√ó</button>
      </div>
      <div class="modal-body">
        <div class="question-image-container">
          <img class="question-image" id="questionImage" alt="Imagem da quest√£o" loading="lazy" />
        </div>
        <h2 class="question-title" id="questionTitle"></h2>
        <p class="question-text" id="questionText"></p>
        <div class="options-list" id="optionsList"></div>
        <div class="feedback" id="feedbackArea"></div>
      </div>
    </div>
  </div>

  <!-- Video Modal -->
  <div class="modal" id="videoModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="V√≠deo">
      <div class="modal-header">
        <span class="modal-title">üé¨ PARAB√âNS!</span>
        <button class="modal-close" id="closeVideo" type="button" aria-label="Fechar">√ó</button>
      </div>
      <div class="modal-body" style="align-items:center;">
        <h2 class="question-title">Voc√™ Juntou Todos os Rob√¥s! ü§ñü§ñü§ñ</h2>
        <p class="question-text" style="margin:16px 0;">Assistindo v√≠deo especial...</p>
        <video id="vPlayer" class="video-player" playsinline muted controls>
          <source src="https://via.placeholder.com/600x400?text=Video+7s" type="video/mp4" />
        </video>
      </div>
    </div>
  </div>

  <!-- Victory Modal -->
  <div class="modal" id="victoryModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-label="Vit√≥ria">
      <div class="victory-content">
        <div class="victory-emoji">üéâ</div>
        <h2 class="victory-title">ESCAPOU!</h2>
        <p style="margin-bottom:20px; color:#aaa;">Voc√™ conquistou todo o conhecimento!</p>

        <div class="victory-stats">
          <div class="victory-stat">
            <div class="victory-value" id="finalCoins">0</div>
            <div class="victory-label">Moedas</div>
          </div>
          <div class="victory-stat">
            <div class="victory-value" id="finalRobots">0</div>
            <div class="victory-label">Rob√¥s</div>
          </div>
          <div class="victory-stat">
            <div class="victory-value" id="finalCorrect">0</div>
            <div class="victory-label">Acertos</div>
          </div>
        </div>

        <button class="restart-btn" id="restartBtn" type="button">üîÑ JOGAR NOVAMENTE</button>
      </div>
    </div>
  </div>

  <script>
    const defaultConfig = { game_title: 'ü´Ä CardioResp Escape' };
    let config = { ...defaultConfig };

    // IMPORTANTE: caminhos RELATIVOS para GitHub Pages
    const QUESTIONS = [
      {
        id: "Quest√£o 1 ‚Äì Mediastino",
        prompt: "O cora√ß√£o localiza-se predominantemente em qual compartimento do mediastino?",
        options: ["A) Superior", "B) Anterior", "C) M√©dio", "D) Posterior", "E) Esquerda"],
        answer: "C",
        image: "assets/images/q1_mediastino.png",
        emoji: "ü´Ä",
        tip: "üí° O mediastino √© dividido em superior, m√©dio, anterior e posterior.",
        main: true
      },
      {
        id: "Quest√£o 2 ‚Äì Irriga√ß√£o",
        prompt: "A art√©ria interventricular anterior √© ramo direto da:",
        options: ["A) Cor. Direita", "B) Cor. Esquerda", "C) Circunflexa", "D) Tor√°cica", "E) Aorta"],
        answer: "B",
        image: "assets/images/q2_coronarias.png",
        emoji: "‚ù§Ô∏è",
        tip: "üí° Duas coron√°rias saem da aorta ascendente.",
        main: true
      },
      {
        id: "Quest√£o 3 ‚Äì Hilo",
        prompt: "No hilo pulmonar, a estrutura que se localiza mais posteriormente √©:",
        options: ["A) Art√©ria", "B) Veias", "C) Br√¥nquio principal", "D) Fr√™nico", "E) Linfonodos"],
        answer: "C",
        image: "assets/images/q3_hilo.png",
        emoji: "üå¨Ô∏è",
        tip: "üí° Lembre: no hilo, o br√¥nquio tende a ficar mais posterior.",
        main: true
      },
      {
        id: "Quest√£o 4 ‚Äì Valvas",
        prompt: "A valva atrioventricular direita est√° localizada entre:",
        options: ["A) AE/VE", "B) VE/Aorta", "C) AD/VD", "D) AD/VCS", "E) VD/Tronco"],
        answer: "C",
        image: "assets/images/q4_valvas.png",
        emoji: "ü´Ä",
        tip: "üí° Tric√∫spide = lado direito (3 c√∫spides).",
        main: true
      },
      {
        id: "Quest√£o 5 ‚Äì Pleuras",
        prompt: "A pleura que reveste diretamente a superf√≠cie do pulm√£o √© denominada:",
        options: ["A) Parietal", "B) Mediastinal", "C) Diafragm√°tica", "D) Visceral", "E) Endot√©lio"],
        answer: "D",
        image: "assets/images/q5_pleura.png",
        emoji: "üå¨Ô∏è",
        tip: "üí° Visceral = √≥rg√£o | Parietal = parede.",
        main: true
      },
      {
        id: "Desafio 1 ‚Äì √Årvore",
        prompt: "O br√¥nquio principal direito tem maior risco de aspira√ß√£o porque √©:",
        options: ["A) Longo/Estreito", "B) Curto/Largo/Vertical", "C) Obl√≠quo", "D) Vertical/Longo"],
        answer: "B",
        image: "assets/images/bonus1_bronquio_direito.png",
        emoji: "üå¨Ô∏è",
        tip: "üí° Br√¥nquio direito = mais vertical ‚Üí maior risco de aspira√ß√£o.",
        main: false
      },
      {
        id: "Desafio 2 ‚Äì Superf√≠cies",
        prompt: "A face esternocostal (anterior) do cora√ß√£o √© formada por:",
        options: ["A) AE", "B) VE", "C) AD", "D) VD", "E) Tronco"],
        answer: "D",
        image: "assets/images/bonus2_face_esternocostal.png",
        emoji: "ü´Ä",
        tip: "üí° Esternocostal = frente (esterno + costelas).",
        main: false
      },
      {
        id: "Desafio 3 ‚Äì Condu√ß√£o",
        prompt: "O n√≥ atrioventricular localiza-se anatomicamente:",
        options: ["A) Teto AD", "B) Septo interatrial", "C) Parede VD", "D) Sulco Ant.", "E) √Åpice"],
        answer: "B",
        image: "assets/images/bonus3_no_av.png",
        emoji: "‚ö°",
        tip: "üí° N√≥ AV: regi√£o do septo interatrial (pr√≥xima ao tr√≠gono fibroso).",
        main: false
      }
    ];

    const gameState = {
      coins: 0,
      solved: [],
      answeringLocked: false
    };

    const ROBOT_NAMES = ['ü§ñ','ü¶æ','ü¶ø','‚öôÔ∏è','üî©','üíª','üéõÔ∏è','üì°'];
    const ROBOT_COLORS = ['#667eea','#764ba2','#f093fb','#4facfe','#43e97b','#fa709a','#fee140','#30cfd0'];

    function init(){
      setUpElementSdkSafe();
      createCardGrid();
      setupEventListeners();
      updateHUD();
    }

    function setUpElementSdkSafe(){
      if (window.elementSdk && typeof window.elementSdk.init === 'function'){
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (cfg) => {
            config = { ...defaultConfig, ...cfg };
            document.getElementById('gameTitle').textContent = config.game_title;
          },
          mapToCapabilities: () => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['game_title', cfg.game_title || defaultConfig.game_title]
          ])
        });
      }
    }

    function createCardGrid(){
      const viewport = document.getElementById('gameViewport');
      viewport.innerHTML = '';

      QUESTIONS.forEach(q => {
        const solved = gameState.solved.includes(q.id);
        const card = document.createElement('div');
        card.className = `question-card ${q.main ? '' : 'bonus'} ${solved ? 'completed' : ''}`;

        const badgeEmoji = solved ? '‚úì' : (q.emoji || '‚ùì');
        const statusText = solved ? 'ü§ñ Completo' : (q.main ? 'Principal' : 'Desafio');

        card.innerHTML = `
          <img class="card-image" src="${q.image}" alt="${q.id}" loading="lazy"
               onerror="this.style.display='none'">
          <div style="font-size:24px; min-height:30px; z-index:2;">${badgeEmoji}</div>
          <div class="card-title">${q.id}</div>
          <div class="card-status">${statusText}</div>
        `;

        if (!solved){
          card.addEventListener('click', () => showQuestion(q));
        }

        viewport.appendChild(card);
      });
    }

    function showQuestion(question){
      gameState.answeringLocked = false;

      document.getElementById('questionBadge').textContent = question.id;
      document.getElementById('questionTitle').textContent = question.id;
      document.getElementById('questionText').textContent = question.prompt;

      const img = document.getElementById('questionImage');
      img.src = question.image;
      img.onerror = () => { img.style.display = 'none'; };
      img.onload = () => { img.style.display = 'block'; };

      const optionsList = document.getElementById('optionsList');
      optionsList.innerHTML = '';

      question.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'option-btn';
        btn.textContent = opt;
        btn.addEventListener('click', () => handleAnswer(question, opt[0]));
        optionsList.appendChild(btn);
      });

      const feedback = document.getElementById('feedbackArea');
      feedback.className = 'feedback';
      feedback.innerHTML = '';

      openModal('questionModal');
    }

    function handleAnswer(question, selectedLetter){
      if (gameState.answeringLocked) return;
      gameState.answeringLocked = true;

      const allBtns = document.querySelectorAll('#optionsList .option-btn');
      allBtns.forEach(btn => btn.disabled = true);

      const feedback = document.getElementById('feedbackArea');
      const isCorrect = selectedLetter === question.answer;

      const correctIndex = question.options.findIndex(opt => opt[0] === question.answer);

      if (isCorrect){
        allBtns[correctIndex]?.classList.add('correct');

        feedback.className = 'feedback show correct';
        feedback.innerHTML = `<strong>‚úì Correto!</strong><br>Voc√™ conquistou um rob√¥! ü§ñ`;

        gameState.coins += 5;
        if (!gameState.solved.includes(question.id)){
          gameState.solved.push(question.id);
        }

        createCoinAnimation();
        createRobotAnimation(gameState.solved.length - 1);
        createCardGrid();
        updateHUD();

        setTimeout(() => {
          closeModal('questionModal');
          showRobotTip(question.tip, gameState.solved.length - 1);
        }, 1400);

        if (gameState.solved.length === 8){
          setTimeout(() => showVideo(), 2500);
        }
      } else {
        allBtns[correctIndex]?.classList.add('correct');

        const selectedIndex = question.options.findIndex(opt => opt[0] === selectedLetter);
        allBtns[selectedIndex]?.classList.add('wrong');

        feedback.className = 'feedback show wrong';
        feedback.innerHTML = `<strong>‚úó Incorreto!</strong><br>Tente novamente para ganhar um rob√¥!`;

        setTimeout(() => closeModal('questionModal'), 1400);
      }
    }

    function createCoinAnimation(){
      for (let i = 0; i < 5; i++){
        setTimeout(() => {
          const coin = document.createElement('div');
          coin.className = 'coin-float';
          coin.textContent = 'ü™ô';
          coin.style.left = (window.innerWidth / 2 + (Math.random() * 200 - 100)) + 'px';
          coin.style.top = (window.innerHeight / 2 + 100) + 'px';
          document.body.appendChild(coin);
          setTimeout(() => coin.remove(), 800);
        }, i * 60);
      }
    }

    function createRobotAnimation(index){
      const collection = document.getElementById('robotCollection');
      const robot = document.createElement('div');
      robot.className = 'robot-collector';
      robot.textContent = ROBOT_NAMES[index] || 'ü§ñ';
      const c1 = ROBOT_COLORS[index] || '#667eea';
      const c2 = ROBOT_COLORS[(index + 1) % 8] || '#764ba2';
      robot.style.background = `linear-gradient(135deg, ${c1}, ${c2})`;
      collection.appendChild(robot);
    }

    function showRobotTip(tip, robotIndex){
      const tipEl = document.createElement('div');
      tipEl.className = 'robot-tip';
      const name = ROBOT_NAMES[robotIndex] || 'ü§ñ';
      tipEl.innerHTML = `<strong>${name} Rob√¥ ${robotIndex + 1}:</strong>${tip}`;
      document.body.appendChild(tipEl);
      setTimeout(() => tipEl.remove(), 4000);
    }

    function showVideo(){
      openModal('videoModal');

      const player = document.getElementById('vPlayer');
      player.currentTime = 0;

      // Tenta dar play (em celular pode exigir intera√ß√£o do usu√°rio)
      const playPromise = player.play();
      if (playPromise && typeof playPromise.catch === 'function'){
        playPromise.catch(() => {
          // se bloquear, o usu√°rio pode apertar play manualmente (controls est√° ligado)
        });
      }

      player.onended = () => {
        closeModal('videoModal');
        showVictory();
      };
    }

    function showVictory(){
      document.getElementById('finalCoins').textContent = gameState.coins;
      document.getElementById('finalRobots').textContent = gameState.solved.length;
      document.getElementById('finalCorrect').textContent = gameState.solved.length;
      openModal('victoryModal');
    }

    function resetGame(){
      gameState.coins = 0;
      gameState.solved = [];
      gameState.answeringLocked = false;
      document.getElementById('robotCollection').innerHTML = '';
      createCardGrid();
      updateHUD();
      closeModal('victoryModal');
      closeModal('videoModal');
      closeModal('questionModal');

      const player = document.getElementById('vPlayer');
      player.pause();
      player.currentTime = 0;
    }

    function updateHUD(){
      document.getElementById('coinCount').textContent = gameState.coins;
      document.getElementById('robotCount').textContent = gameState.solved.length;
    }

    function openModal(id){
      const m = document.getElementById(id);
      m.classList.add('open');
      m.setAttribute('aria-hidden', 'false');
    }

    function closeModal(id){
      const m = document.getElementById(id);
      m.classList.remove('open');
      m.setAttribute('aria-hidden', 'true');

      if (id === 'videoModal'){
        const player = document.getElementById('vPlayer');
        player.pause();
      }
    }

    function setupEventListeners(){
      document.getElementById('closeQuestion').addEventListener('click', () => closeModal('questionModal'));
      document.getElementById('closeVideo').addEventListener('click', () => closeModal('videoModal'));
      document.getElementById('restartBtn').addEventListener('click', resetGame);
      document.getElementById('resetBtn').addEventListener('click', resetGame);

      // Fechar ao clicar fora (no fundo escuro)
      document.getElementById('questionModal').addEventListener('click', (e) => {
        if (e.target.id === 'questionModal') closeModal('questionModal');
      });
      document.getElementById('videoModal').addEventListener('click', (e) => {
        if (e.target.id === 'videoModal') closeModal('videoModal');
      });
      document.getElementById('victoryModal').addEventListener('click', (e) => {
        if (e.target.id === 'victoryModal') closeModal('victoryModal');
      });

      // ESC fecha modais
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape'){
          closeModal('questionModal');
          closeModal('videoModal');
          closeModal('victoryModal');
        }
      });
    }

    init();
  </script>
</body>
</html>
